<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="CI Installer" default="Install">

  <!-- These should be passed on the command line
  <property name="ProjectName" value="" />
  -->

  <!-- These can be passed on the command line
  <property name="ProjectCodeLineName" value="Current"/>
  -->

  <include buildfile="Arguments.xml"/>
  
  <include buildfile="Properties.Install.xml"/>
  <include buildfile="Scripts\Common.Install.xml"/>
  <include buildfile="Scripts\CCNETServer.Install.xml"/>
  <include buildfile="Scripts\nAnt.Install.xml"/>
  <include buildfile="Scripts\BuildVS.Install.xml"/>
  <include buildfile="Scripts\CCNETDashboard.Install.xml"/>
  <include buildfile="Scripts\Packages.Install.xml"/>
  <include buildfile="Scripts\ProductVS.Install.xml"/>
  <include buildfile="Scripts\VSS.Install.xml"/>

  <target name="Install" depends="Private.Install.ValidateParameters">
    <call target="Private.Install.CreateDirectoryStructure"/>
    <call target="CCNETServer.Install"/>
    <call target="nAnt.Install"/>
    <call target="BuildVS.Install"/>
    <call target="CCNETDashboard.Install"/>
    <call target="Packages.Install"/>
    <call target="ProductVS.Install"/>
    <call target="VSS.Install"/>
  </target>

  <target name="Private.Install.ValidateParameters" >
    <fail if="${property::exists('ProjectName') == false}" message="Property ProjectName was not set on the commandline."/>
    
    <call target="CCNETServer.ValidateParameters"/>
    <call target="nAnt.ValidateParameters"/>
    <call target="BuildVS.ValidateParameters"/>
    <call target="CCNETDashboard.ValidateParameters"/>
    <call target="Packages.ValidateParameters"/>
    <call target="ProductVS.ValidateParameters"/>
    <call target="ProductVS.Install"/>
  </target>

  <target name="Private.Install.CreateDirectoryStructure">
    <mkdir if="${directory::exists(ProjectsDirectory) == false}"        dir="${ProjectsDirectory}"/>
    <mkdir if="${directory::exists(ProjectRootDirectory) == false}"     dir="${ProjectRootDirectory}"/>
    <mkdir if="${directory::exists(ProjectCodeLineDirectory) == false}" dir="${ProjectCodeLineDirectory}"/>
    <mkdir if="${directory::exists(ProductDirectory) == false}"         dir="${ProductDirectory}"/>
    <mkdir if="${directory::exists(ThirdPartyDirectory) == false}"      dir="${ThirdPartyDirectory}"/>
    <mkdir if="${directory::exists(ProductionDirectory) == false}"      dir="${ProductionDirectory}"/>
    <mkdir if="${directory::exists(InstallDirectory) == false}"         dir="${InstallDirectory}"/>
    <mkdir if="${directory::exists(UnitTestDirectory) == false}"        dir="${UnitTestDirectory}"/>
    <mkdir if="${directory::exists(BuildDirectory) == false}"           dir="${BuildDirectory}"/>
    <mkdir if="${directory::exists(BuildPackagesDirectory) == false}"   dir="${BuildPackagesDirectory}"/>
  </target>
  
</project>